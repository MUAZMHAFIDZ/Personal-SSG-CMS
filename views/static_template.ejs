<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %></title>
    <meta name="description" content="<%= meta_description || '' %>" />
    <meta name="keywords" content="<%= meta_keywords || '' %>" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <style>
      body {
        background: url("<%= baseUrl %>/uploads/bg.webp") center/cover no-repeat
          fixed;
        position: relative;
        overflow-x: hidden;
      }

      #editor {
        min-height: 200px;
      }
      @media (min-width: 768px) {
        #editor {
          min-height: 400px;
        }
      }

      .ql-container.ql-snow {
        border: 0 !important;
        box-shadow: none !important;
        background: transparent !important;
      }
      .ql-editor {
        background: transparent !important;
        padding: 0 !important;
      }
      #editor img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 1rem auto;
        border-radius: 8px;
      }
      .ql-editor,
      .ql-container.ql-snow {
        font-family: "Inter", ui-sans-serif, system-ui, -apple-system,
          BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial,
          "Noto Sans", sans-serif !important;
        font-size: 1rem;
        line-height: 1.6;
      }

      .penguin {
        position: absolute;
        width: 100px;
        animation: dance 4s ease-in-out infinite;
      }
      @media (max-width: 768px) {
        .penguin {
          display: none;
        }
      }
      @keyframes dance {
        0% {
          transform: translateX(0) translateY(0) rotate(0deg) scale(1);
        }
        25% {
          transform: translateX(-20px) translateY(5px) rotate(-10deg)
            scale(1.05);
        }
        50% {
          transform: translateX(0) translateY(10px) rotate(10deg) scale(0.95);
        }
        75% {
          transform: translateX(20px) translateY(5px) rotate(-5deg) scale(1.02);
        }
        100% {
          transform: translateX(0) translateY(0) rotate(0deg) scale(1);
        }
      }
    </style>
  </head>

  <body class="min-h-screen">
    <!-- Penguins -->
    <img
      src="<%= baseUrl %>/uploads/penguin1.png"
      class="penguin"
      style="top: 10%; animation-delay: 0s"
    />
    <img
      src="<%= baseUrl %>/uploads/penguin2.png"
      class="penguin"
      style="top: 20%; animation-delay: 0s"
    />
    <img
      src="<%= baseUrl %>/uploads/penguin2.png"
      class="penguin"
      style="top: 50%; animation-delay: 0s"
    />
    <img
      src="<%= baseUrl %>/uploads/penguin3.png"
      class="penguin"
      style="top: 30%; animation-delay: 0s"
    />
    <img
      src="<%= baseUrl %>/uploads/penguin1.png"
      class="penguin"
      style="top: 40%; animation-delay: 0s"
    />
    <img
      src="<%= baseUrl %>/uploads/penguin3.png"
      class="penguin"
      style="top: 70%; animation-delay: 0s"
    />

    <!-- Navbar -->
    <nav class="bg-white shadow sticky top-0 z-50">
      <div
        class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="text-xl font-bold">
          <a href="<%= baseUrl %>/index.html">My Blog</a>
        </div>
        <div class="hidden md:flex space-x-4">
          <a href="<%= baseUrl %>/index.html" class="hover:text-blue-600"
            >Home</a
          >
          <a href="https://MuazMHafidz.my.id" class="hover:text-blue-600"
            >About</a
          >
          <button id="searchToggle" class="px-2">üîç</button>
        </div>
        <div class="md:hidden flex items-center space-x-2">
          <button id="searchToggleMobile" class="px-2">üîç</button>
          <button id="mobileMenuToggle">‚ò∞</button>
        </div>
      </div>
      <div
        id="mobileMenu"
        class="hidden flex-col px-4 py-2 space-y-2 bg-white md:hidden"
      >
        <a href="<%= baseUrl %>/index.html" class="block">Home</a>
        <a href="https://MuazMHafidz.my.id" class="block">Profile</a>
      </div>
    </nav>

    <!-- Main Article -->
    <main
      class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-4 md:p-6 mt-8 relative z-10"
    >
      <h1 class="text-3xl md:text-4xl font-bold mb-2 leading-tight break-words">
        <%= title %>
      </h1>
      <img
        src="<%= article.thumbnail %>"
        alt="<%= title %>"
        class="w-full h-auto object-cover rounded mb-6"
      />
      <p class="text-gray-500 text-sm mb-6">Created: <%= created_at %></p>
      <div id="editor"><%- content %></div>
    </main>

    <!-- Other Articles -->
    <% if(previousArticles && previousArticles.length){ %>
    <section class="max-w-4xl mx-auto mt-12 mb-12 px-4">
      <h2 class="text-2xl font-semibold text-center mb-6">Other Articles</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <% previousArticles.forEach(article => { %>
        <div
          class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition p-4"
        >
          <img
            src="<%= article.thumbnail %>"
            alt="<%= article.title %>"
            class="w-full h-40 object-cover rounded mb-4"
          />
          <h3 class="text-lg font-bold break-words">
            <a href="./<%= article.slug %>.html" class="hover:text-blue-600"
              ><%= article.title %></a
            >
          </h3>
          <p class="text-gray-600 text-sm mt-2 break-words">
            <%= article.content.replace(/<[^>]+>/g, "").substring(0, 80) %>...
          </p>
        </div>
        <% }) %>
      </div>
    </section>
    <% } %>

    <!-- Footer -->
    <footer class="bg-[rgba(255,255,255,0.5)] shadow-inner py-3 mt-10">
      <div class="max-w-7xl mx-auto px-4 text-center text-blue-900">
        &copy; 2025 <a href="https://MuazMHafidz.my.id">MuazMHafidz</a>. All
        rights reserved.
      </div>
    </footer>

    <!-- Search Overlay -->
    <div
      id="searchOverlay"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex justify-center items-start overflow-auto pt-12 md:pt-20 px-2"
    >
      <div class="bg-white rounded-md p-4 md:p-6 w-full max-w-md relative">
        <input
          type="text"
          id="searchInput"
          placeholder="Search articles..."
          class="border border-gray-300 p-2 w-full rounded mb-2"
        />
        <button
          id="searchButton"
          class="bg-blue-600 text-white px-4 py-2 rounded mb-4 w-full"
        >
          Search
        </button>
        <div
          id="searchResults"
          class="space-y-2 max-h-96 overflow-auto break-words"
        ></div>
        <button id="searchClose" class="absolute top-2 right-2 text-gray-500">
          ‚úï
        </button>
      </div>
    </div>

    <script>
      // Mobile menu toggle
      document
        .getElementById("mobileMenuToggle")
        ?.addEventListener("click", () => {
          const menu = document.getElementById("mobileMenu");
          menu.classList.toggle("hidden");
        });

      // Initialize Quill read-only
      var quill = new Quill("#editor", {
        theme: "snow",
        readOnly: true,
        modules: { toolbar: false },
      });

      // Toggle overlay
      const searchToggle = document.getElementById("searchToggle");
      const searchToggleMobile = document.getElementById("searchToggleMobile");
      const searchOverlay = document.getElementById("searchOverlay");
      const searchClose = document.getElementById("searchClose");

      searchToggle?.addEventListener("click", () =>
        searchOverlay.classList.remove("hidden")
      );
      searchToggleMobile?.addEventListener("click", () =>
        searchOverlay.classList.remove("hidden")
      );
      searchClose?.addEventListener("click", () =>
        searchOverlay.classList.add("hidden")
      );

      // Close overlay when click outside search box
      searchOverlay?.addEventListener("click", (e) => {
        const searchBox = e.currentTarget.querySelector("div");
        if (!searchBox.contains(e.target))
          searchOverlay.classList.add("hidden");
      });

      // Search via enter or button
      const searchInput = document.getElementById("searchInput");
      const searchButton = document.getElementById("searchButton");
      searchInput?.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const query = e.target.value.trim();
          if (query)
            window.location.href = `/search/${encodeURIComponent(query)}`;
        }
      });
      searchButton?.addEventListener("click", () => {
        const query = searchInput.value.trim();
        if (query)
          window.location.href = `/search/${encodeURIComponent(query)}`;
      });
    </script>
  </body>
</html>
